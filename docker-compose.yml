# =====================
# Docker Compose設定
# =====================
# 開発・テスト環境での簡単な起動用

version: '3.8'

services:
  # スポンサーシップサービス
  sponsorship-service:
    # Dockerfileからビルド
    build:
      context: .
      dockerfile: Dockerfile
      target: production

    # コンテナ名
    container_name: mee-sponsorship-service

    # ポートマッピング（ホスト:コンテナ）
    ports:
      - "3004:3004"

    # 環境変数ファイルから読み込む場合（推奨）
    env_file:
      - .env

    # 再起動ポリシー
    restart: unless-stopped

    # ヘルスチェック
    healthcheck:
      test: ["CMD", "bun", "-e", "fetch('http://localhost:3004/v1/sponsorship/info').then(r => r.ok ? process.exit(0) : process.exit(1)).catch(() => process.exit(1))"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3

    # リソース制限（任意）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.5'
    #       memory: 256M
